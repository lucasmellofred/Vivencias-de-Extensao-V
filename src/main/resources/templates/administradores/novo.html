<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
  <link rel="icon" th:href="@{/favicon-32x32.png}" type="image/png">
  <link rel="stylesheet" th:href="@{/style-padrao.css}" type="text/css">
	<title>Novo Administrador</title>
</head>
<body class="corpo">
	<header th:replace="~{layout :: header-content}"></header>
	<div class="d-flex flex-column flex-shrink-0" style="float: left; width: -webkit-fill-available;">
		<div class="p-3 rounded-2">
			<div class="d-flex">
				<h1>Cadastrar um novo Administrador</h1>
				<div class="ms-auto">
					<a id="btnVoltar" class="btn btn-secondary">Voltar</a>
				</div>
			</div>
			<div class="d-flex justify-content-center align-items-center p-3 rounded-2">
				<div class="p-3 rounded-2" style="background-color: #fff3cd;width: 400px;">
					<form id="myForm" th:action="@{/administradores/criar}" th:object="${administrador}" method="POST" onsubmit="return confirm('Confirma ação?'); return validateForm()">
						<div class="input-group mt-2 mb-2">
							<span  class="input-group-text" for="nome">Nome</span>
							<input class="form-control" type="text" id="nome" name="nome" required>
						</div>

						<div class="input-group mt-2 mb-2">
							<span  class="input-group-text" for="email">Email</span>
							<input class="form-control" type="email" id="email" name="email" autocomplete="off" required>
						</div>

						<div class="input-group mt-2 mb-2">
							<span  class="input-group-text" for="telefone">Telefone</span>
							<input class="form-control" type="text" id="telefoneInput" name="telefone" required>
						</div>
						
						<div class="password-toggle input-group mb-2">
              <span class="input-group-text" for="senha">Senha:</span>
              <input type="password" class="form-control" id="senha" name="senha" autocomplete="off" required>
              <button class="button-toggle-password btn btn-outline-secondary" type="button" id="button-addon2" onclick="togglePasswordVisibility()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16">
                  <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"/>
                  <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"/>
                </svg>
              </button>
            </div>
            
            <div class="input-group mt-2 mb-4">
              <span class="input-group-text" for="confirmarSenha">Repetir senha:</span>
              <input type="password" class="form-control" id="confirmarSenha" name="confirmarSenha" required>
              <button class="button-toggle-password-confirm btn btn-outline-secondary" type="button" id="button-addon1" onclick="togglePasswordVisibility1()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye" viewBox="0 0 16 16">
                  <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"/>
                  <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"/>
                </svg>
              </button>
            </div>

						<hr>
						<div th:if="${erroCadastro != null}" th:text="${erroCadastro}" class="alert alert-danger" role="alert"></div>
						<div id="passwordValidationMessage" class="invalid-feedback"></div>

						<div class="d-flex justify-content-center align-items-center" id="divBotaoEnvio">
							<button id="customSubmitButton" class="btn btn-warning w-100 py-2" type="button" onclick="validateAndSubmit()">Cadastrar</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
	<script>
		function togglePasswordVisibility() {
			var senhaInput = document.getElementById('senha');
			var icon = document.querySelector('.button-toggle-password svg');

			if (senhaInput.type === 'password') {
				senhaInput.type = 'text';
				icon.innerHTML = '<path d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7 7 0 0 0-2.79.588l.77.771A6 6 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755q-.247.248-.517.486z"/><path d="M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.829 2.829zm-2.943 1.299.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.829 2.829"/><path d="M3.35 5.47q-.27.24-.518.487A13 13 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7 7 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.709zm10.296 8.884-12-12 .708-.708 12 12z"/>';
			} else {
				senhaInput.type = 'password';
				icon.innerHTML = '<path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"/><path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"/>';
			}
		}

		function togglePasswordVisibility1() {
			var confirmarSenhaInput = document.getElementById('confirmarSenha');
			var iconConfirm = document.querySelector('.button-toggle-password-confirm svg');

			if (confirmarSenhaInput.type === 'password') {
				confirmarSenhaInput.type = 'text';
				iconConfirm.innerHTML = '<path d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7 7 0 0 0-2.79.588l.77.771A6 6 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755q-.247.248-.517.486z"/><path d="M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.829 2.829zm-2.943 1.299.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.829 2.829"/><path d="M3.35 5.47q-.27.24-.518.487A13 13 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7 7 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.709zm10.296 8.884-12-12 .708-.708 12 12z"/>';
			} else {
				confirmarSenhaInput.type = 'password';
				iconConfirm.innerHTML = '<path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"/><path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"/>';
			}
		}
		
		window.onload = function() {
			var emailField = document.getElementById('email');
			var passwordField = document.getElementById('senha');
			emailField.value = '';
			passwordField.value = '';
	}

		var confirmarSenhaInput = document.getElementById('confirmarSenha');

		// Adiciona eventos de entrada e foco apenas para o campo de confirmação de senha
		confirmarSenhaInput.addEventListener('input', validatePasswordMatch);
		confirmarSenhaInput.addEventListener('focus', validatePasswordMatch);

		function validatePasswordMatch() {
			var senhaInput = document.getElementById('senha').value;
			var validationMessage = document.getElementById('passwordValidationMessage');

			if (confirmarSenhaInput.value === senhaInput) {
				// Senhas correspondem, remover estilo de erro e mensagem
				confirmarSenhaInput.classList.remove('is-invalid');
				validationMessage.innerHTML = '';
			} else {
				// Senhas não correspondem, adicionar estilo de erro e mensagem
				confirmarSenhaInput.classList.add('is-invalid');
				validationMessage.innerHTML = 'Senhas não correspondem!';
			}
		}

		function validateAndSubmit() {
			var emailInput = document.getElementById('email').value;
			var nomeInput = document.getElementById('nome').value;
			var telefoneInput = document.getElementById('telefoneInput').value;
			var senhaInput = document.getElementById('senha').value;
			var confirmarSenhaInput = document.getElementById('confirmarSenha').value;
	
			// Validar se o campo de e-mail está vazio ou não é um e-mail válido
			if (emailInput === '' || !validateEmail(emailInput)) {
					showFloatingAlert('Insira um e-mail válido.');
					return;
			}
	
			// Validar se o campo de nome está vazio
			if (nomeInput === '') {
					showFloatingAlert('Insira seu nome.');
					return;
			}

			// Validar se o campo de telefone está vazio
			if (telefoneInput === '') {
					showFloatingAlert('Insira seu telefone.');
					return;
			}
	
			// Validar se o campo de senha está vazio
			if (senhaInput === '') {
					showFloatingAlert('Insira uma senha.');
					return;
			}
	
			// Validar correspondência de senha
			if (senhaInput !== confirmarSenhaInput) {
					showFloatingAlert('Senhas não correspondem!');
					return;
			}
	
			// Senhas correspondem, continuar com o envio do formulário
			validatePasswordMatch();
			if (!document.getElementById('confirmarSenha').classList.contains('is-invalid')) {
					document.getElementById('myForm').submit();
			}
	}

		function validateEmail(email) {
			// Expressão regular para validar e-mails
			var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
			return emailRegex.test(email);
		}
		
		var floatingAlert = null; // Variável global para armazenar o alerta

		function showFloatingAlert(message) {
			// Se já houver um alerta flutuante, remova-o antes de criar um novo
			if (floatingAlert) {
				floatingAlert.remove();
			}

			// Criação do alerta flutuante
			floatingAlert = document.createElement('div');
			floatingAlert.className = 'alert alert-danger'; // Adiciona margem superior para separá-lo do botão
			floatingAlert.setAttribute('role', 'alert');
			floatingAlert.innerHTML = `
				${message}
			`;
			
			// Obtém o botão de envio do formulário e seu elemento pai
			var submitButton = document.getElementById('divBotaoEnvio');
			var parentElement = submitButton.parentNode;

			// Insere o alerta flutuante antes do botão de envio
			parentElement.insertBefore(floatingAlert, submitButton);
		}
		
		// Função para formatar o telefone
		function formatarTelefone(input) {
			// Remove todos os caracteres não numéricos
			var numeros = input.value.replace(/\D/g, '');
			
			// Verifica o comprimento atual da entrada de números
			var comprimento = numeros.length;

			// Aplica a formatação de acordo com o comprimento atual
			var telefoneFormatado;
			if (comprimento <= 2) {
					telefoneFormatado = '(' + numeros;
			} else if (comprimento <= 6) {
					telefoneFormatado = '(' + numeros.substring(0, 2) + ') ' + numeros.substring(2);
			} else if (comprimento <= 10) {
					telefoneFormatado = '(' + numeros.substring(0, 2) + ') ' + numeros.substring(2, 6) + '-' + numeros.substring(6);
			} else {
					telefoneFormatado = '(' + numeros.substring(0, 2) + ') ' + numeros.substring(2, 7) + '-' + numeros.substring(7, 11);
			}
			
			// Define o valor formatado de volta no input
			input.value = telefoneFormatado;
	}

		// Adiciona um event listener para formatar o telefone enquanto o usuário digita
		document.getElementById('telefoneInput').addEventListener('input', function() {
				formatarTelefone(this);
		});

		// Adiciona um event listener para limitar o número de caracteres no telefone
		document.getElementById('telefoneInput').addEventListener('keypress', function(e) {
				// Permite apenas números e uma quantidade máxima de 11 dígitos
				var input = e.key;
				var numeros = /^[0-9]+$/;
				if (!input.match(numeros) || this.value.replace(/\D/g, '').length >= 11) {
						e.preventDefault();
				}
		});
	</script>
</body>
</html>